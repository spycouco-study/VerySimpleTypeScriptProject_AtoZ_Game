<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Alparka!</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon.png" sizes="32x32">
</head>
<body>
    <h2>ì•Œì•„ì„œ ë§Œë“¤ì–´ ì£¼ëŠ” AI ë†€ì´ê³µì›, Alparka!</h2>
    <canvas id="gameCanvas" width="700" height="600" style="display:block; margin:auto;"></canvas>
    
<!-- 
    <script>
    const SERVER_URL = 'http://localhost:8080/client-error'; // ì„œë²„ URL í†µì¼

    // ê³µí†µ ì „ì†¡ + ì½˜ì†” ì¶œë ¥ í•¨ìˆ˜
    function sendError(data) {
        // console.log("error : ",data.type); // type ì¶œë ¥ì€ ë””ë²„ê¹… ì‹œì—ë§Œ ì‚¬ìš©
        data.game_version = '1.0.1';
        data.time = new Date().toISOString();

        switch (data.type) {
            case 'page-load':
                console.log('%cğŸ“¥ í˜ì´ì§€ ì ‘ì† ì™„ë£Œ', 'color: green; font-weight: bold;', data);
                break;
            case 'js-error':
                console.error('%cğŸ’¥ JS ëŸ°íƒ€ì„ ì—ëŸ¬', 'color: red; font-weight: bold;', data);
                break;
            case 'unhandledrejection':
                console.error('%câš ï¸ Promise ë¹„ë™ê¸° ì—ëŸ¬', 'color: orange; font-weight: bold;', data);
                break;
            case 'resource-error':
                console.warn('%cğŸ–¼ï¸ ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì‹¤íŒ¨', 'color: purple; font-weight: bold;', data);
                break;
            case 'fetch-failed':
                console.error('%cğŸ“¡ ì„œë²„ ì „ì†¡ ì‹¤íŒ¨', 'color: darkred; font-weight: bold;', data);
                break;
            case 'media-error':
                console.error('%cğŸ”Š ë¯¸ë””ì–´ ì¬ìƒ ì‹¤íŒ¨', 'color: darkorange; font-weight: bold;', data);
                break;
            case 'game-loop-error':
                console.error('%cğŸ® ê²Œì„ ë£¨í”„ ì—ëŸ¬', 'color: crimson; font-weight: bold;', data);
                break;
            default:
                console.log('%câ„¹ï¸ ê¸°íƒ€ ì´ë²¤íŠ¸', 'color: blue;', data);
                break;
        }

        // ì„œë²„ ì „ì†¡
        fetch(SERVER_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        }).catch(err => {
            console.error('âŒ ì„œë²„ ì „ì†¡ ì‹¤íŒ¨ (fetch catch):', err);
            const failData = {
                type: 'fetch-failed',
                original: data,
                reason: err.message
            };
            // ì´ 2ì°¨ ì˜¤ë¥˜ëŠ” ì„œë²„ì— ë³´ë‚´ì§€ ì•Šê³  ì½˜ì†”ì—ë§Œ ê¸°ë¡
            console.log('ğŸ“¡ fetch ì‹¤íŒ¨ ë¡œê·¸:', failData); 
        });
    }

    // 1ï¸âƒ£ í˜ì´ì§€ ì ‘ì† ì™„ë£Œ
    window.addEventListener('load', () => {
        sendError({ type: 'page-load', message: 'í˜ì´ì§€ ì ‘ì† ì™„ë£Œ' });
    });

    // 2ï¸âƒ£ JS ëŸ°íƒ€ì„ ì—ëŸ¬
    window.onerror = function(message, source, lineno, colno, error) {
        sendError({
            type: 'js-error',
            message,
            source,
            lineno,
            colno,
            stack: error ? error.stack : 'N/A'
        });
        return false;
    };

    // 3ï¸âƒ£ Promise ë¹„ë™ê¸° ì—ëŸ¬
    window.addEventListener('unhandledrejection', function(event) {
        sendError({
            type: 'unhandledrejection',
            message: event.reason?.message || event.reason,
            stack: event.reason?.stack || 'N/A'
        });
    });

    // 4ï¸âƒ£ HTML íƒœê·¸ë¡œ ë¡œë“œëœ ì´ë¯¸ì§€/ìŠ¤í¬ë¦½íŠ¸/CSS ë¡œë“œ ì‹¤íŒ¨
    window.addEventListener('error', function(event) {
        const target = event.target;
        if (target instanceof HTMLImageElement ||
            target instanceof HTMLScriptElement ||
            target instanceof HTMLLinkElement) {
            sendError({
                type: 'resource-error',
                tag: target.tagName,
                url: target.src || target.href
            });
        }
    }, true);

    // 5ï¸âƒ£ ë™ì  ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ìë™ ê°ì§€
    const originalImage = window.Image;
    window.Image = function() {
        const img = new originalImage();
        const originalOnError = img.onerror;

        img.onerror = function(event) {
            sendError({
                type: 'resource-error',
                tag: 'IMG',
                url: img.src,
                message: 'ë™ì  ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'
            });
            if (originalOnError) originalOnError.call(img, event);
        };

        return img;
    };

    // 6ï¸âƒ£ ê²Œì„ ë£¨í”„ ì—ëŸ¬ ê°ì§€ (requestAnimationFrame)
    // ğŸŒŸ windowì— í•¨ìˆ˜ë¥¼ í• ë‹¹í•˜ì—¬ game.js ëª¨ë“ˆì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•¨
    window.safeGameLoop = function(loopFunction) {
        function wrappedLoop() {
            try {
                loopFunction();
            } catch(e) {
                sendError({
                    type: 'game-loop-error',
                    message: (e as Error).message, // TypeScript ëŒ€ì‘ì„ ìœ„í•´ ëª…ì‹œì ìœ¼ë¡œ íƒ€ì… ìºìŠ¤íŒ… (TS ì»´íŒŒì¼ëŸ¬ê°€ ì¡ì•„ì¤Œ)
                    stack: (e as Error).stack
                });
            }
            requestAnimationFrame(wrappedLoop);
        }
        requestAnimationFrame(wrappedLoop);
    };

    // 7ï¸âƒ£ ë¯¸ë””ì–´ ìë™ì¬ìƒ ì˜¤ë¥˜ ì²˜ë¦¬
    // ğŸŒŸ windowì— í•¨ìˆ˜ë¥¼ í• ë‹¹í•˜ì—¬ game.js ëª¨ë“ˆì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•¨
    window.safePlayMedia = function(mediaElement) {
        try {
            mediaElement.play();
        } catch(e) {
            sendError({
                type: 'media-error',
                message: (e as Error).message,
                stack: (e as Error).stack
            });
        }
    };
    </script> -->




    <script defer>     
        const SERVER_URL = 'http://localhost:8000/client-error'; // âœ… ëˆ„ë½ ë°©ì§€   

// ğŸŒŸ 1. ì›ë˜ í•¨ìˆ˜ë“¤ì„ ì „ì—­ì ìœ¼ë¡œ ë°±ì—…í•©ë‹ˆë‹¤.
        const originalConsoleLog = window.console.log;
        const originalConsoleError = window.console.error;
        const originalConsoleWarn = window.console.warn;

        // ê³µí†µ ì „ì†¡ + ì½˜ì†” ì¶œë ¥ í•¨ìˆ˜
        function sendError(data) {
            data.game_version = '1.0.1';
            data.time = new Date().toISOString();

            // ğŸŒŸ 2. switch ë¬¸ ë‚´ë¶€ì˜ console í˜¸ì¶œì„ ë°±ì—…ëœ í•¨ìˆ˜ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
            switch (data.type) {
                case 'console-error':
                    originalConsoleError.call(window.console, '%cğŸ“¥ ì½˜ì†” ì—ëŸ¬', 'color: green; font-weight: bold;', data);
                    break;
                case 'page-load':
                    originalConsoleLog.call(window.console, '%cğŸ“¥ í˜ì´ì§€ ì ‘ì† ì™„ë£Œ', 'color: green; font-weight: bold;', data);
                    break;
                case 'js-error':
                    // console.error ëŒ€ì‹  originalConsoleError ì‚¬ìš©
                    originalConsoleError.call(window.console, '%cğŸ’¥ JS ëŸ°íƒ€ì„ ì—ëŸ¬', 'color: red; font-weight: bold;', data);
                    break;
                case 'unhandledrejection':
                    originalConsoleError.call(window.console, '%câš ï¸ Promise ë¹„ë™ê¸° ì—ëŸ¬', 'color: orange; font-weight: bold;', data);
                    break;
                case 'resource-error':
                    // console.warn ëŒ€ì‹  originalConsoleWarn ì‚¬ìš©
                    originalConsoleWarn.call(window.console, '%cğŸ–¼ï¸ ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì‹¤íŒ¨', 'color: purple; font-weight: bold;', data);
                    break;
                case 'fetch-failed':
                    originalConsoleError.call(window.console, '%cğŸ“¡ ì„œë²„ ì „ì†¡ ì‹¤íŒ¨', 'color: darkred; font-weight: bold;', data);
                    break;
                case 'media-error':
                    originalConsoleError.call(window.console, '%cğŸ”Š ë¯¸ë””ì–´ ì¬ìƒ ì‹¤íŒ¨', 'color: darkorange; font-weight: bold;', data);
                    break;
                case 'game-loop-error':
                    originalConsoleError.call(window.console, '%cğŸ® ê²Œì„ ë£¨í”„ ì—ëŸ¬', 'color: crimson; font-weight: bold;', data);
                    break;
                default:
                    originalConsoleLog.call(window.console, '%câ„¹ï¸ ê¸°íƒ€ ì´ë²¤íŠ¸', 'color: blue;', data);
                    break;
            }

            // ... (fetch í˜¸ì¶œ ë¡œì§ë„ ë‚´ë¶€ì˜ console.error/logë¥¼ ë°±ì—… í•¨ìˆ˜ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.)
            fetch(SERVER_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            }).catch(err => {
                // console.error ëŒ€ì‹  originalConsoleError ì‚¬ìš©
                originalConsoleError.call(window.console, 'âŒ ì„œë²„ ì „ì†¡ ì‹¤íŒ¨ (fetch catch):', err);
                const failData = {
                    type: 'fetch-failed',
                    original: data,
                    reason: err.message
                };
                // console.log ëŒ€ì‹  originalConsoleLog ì‚¬ìš©
                originalConsoleLog.call(window.console, 'ğŸ“¡ fetch ì‹¤íŒ¨ ë¡œê·¸:', failData);
            });
        }

        // 2ï¸âƒ£ JS ëŸ°íƒ€ì„ ì—ëŸ¬
        window.onerror = function(message, source, lineno, colno, error) {
            sendError({
                type: 'js-error',
                message,
                source,
                lineno,
                colno,
                stack: error ? error.stack : 'N/A'
            });
            return false;
        };

        window.console.error = function(...args) {
            // 1. ê¸°ì¡´ ì½˜ì†” ì¶œë ¥ ë™ì‘ ìœ ì§€
            //originalConsoleError.apply(window.console, args);

            // 2. ì„œë²„ ì „ì†¡ì„ ìœ„í•œ ë©”ì‹œì§€ êµ¬ì„±
            const message = args.map(arg => {
                if (typeof arg === 'object' && arg !== null) {
                    return JSON.stringify(arg);
                }
                return String(arg);
            }).join(' ');

            // 3. ì„œë²„ ì „ì†¡
            sendError({
                type: 'console-error',
                message: 'Explicit console.error call: ' + message,
                detail: args.length > 0 ? args[0] : null
            });
        };
    </script>

    <script type="module" src="/game.js"></script>
</body>
</html>