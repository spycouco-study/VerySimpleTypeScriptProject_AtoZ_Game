let canvas;
let ctx;
let gameSettings;
let assets = { images: {}, sounds: {} };
let gameState = "TITLE";
let snake = [];
let food;
let score = 0;
let direction = { x: 1, y: 0 };
let nextDirection = { x: 1, y: 0 };
let lastMoveTime = 0;
let gameLoopId;
async function initGame() {
  canvas = document.getElementById("gameCanvas");
  if (!canvas) {
    console.error("Canvas element with ID 'gameCanvas' not found.");
    return;
  }
  ctx = canvas.getContext("2d");
  await loadGameData();
  setupCanvas();
  setupEventListeners();
  if (assets.sounds.bgm) {
    assets.sounds.bgm.loop = true;
    assets.sounds.bgm.volume = gameSettings.bgmVolume;
    assets.sounds.bgm.muted = true;
  }
  gameLoopId = requestAnimationFrame(gameLoop);
}
async function loadGameData() {
  try {
    const response = await fetch("data.json");
    const data = await response.json();
    gameSettings = data.gameSettings;
    Object.assign(gameSettings, data.colors, data.text);
    await loadAssets(data.assets);
  } catch (error) {
    console.error("Failed to load game data or assets:", error);
  }
}
async function loadAssets(assetData) {
  const loadImagePromises = (assetData.images || []).map((img) => {
    return new Promise((resolve, reject) => {
      const image = new Image();
      image.src = img.path;
      image.onload = () => {
        assets.images[img.name] = image;
        resolve();
      };
      image.onerror = () => {
        console.error(`Failed to load image: ${img.path}`);
        reject();
      };
    });
  });
  const loadSoundPromises = (assetData.sounds || []).map((snd) => {
    return new Promise((resolve, reject) => {
      const audio = new Audio();
      audio.src = snd.path;
      audio.volume = snd.volume || 1;
      audio.oncanplaythrough = () => {
        assets.sounds[snd.name] = audio;
        resolve();
      };
      audio.onerror = () => {
        console.error(`Failed to load sound: ${snd.path}`);
        reject();
      };
      audio.load();
    });
  });
  await Promise.all([...loadImagePromises, ...loadSoundPromises]);
  console.log("All assets loaded.");
}
function setupCanvas() {
  canvas.width = gameSettings.canvasWidth;
  canvas.height = gameSettings.canvasHeight;
  ctx.imageSmoothingEnabled = false;
}
function setupEventListeners() {
  document.addEventListener("keydown", handleKeyDown);
  document.addEventListener("click", handleUserInteraction, { once: true });
  document.addEventListener("touchstart", handleUserInteraction, { once: true });
}
function handleUserInteraction() {
  if (assets.sounds.bgm) {
    assets.sounds.bgm.muted = false;
    assets.sounds.bgm.play().catch((e) => console.warn("Background music autoplay prevented:", e));
  }
}
function handleKeyDown(event) {
  if (gameState === "TITLE" || gameState === "INSTRUCTIONS" || gameState === "GAME_OVER") {
    if (event.code === "Space") {
      playSound("menuSelect");
      if (gameState === "TITLE") {
        gameState = "INSTRUCTIONS";
      } else if (gameState === "INSTRUCTIONS") {
        gameState = "PLAYING";
        resetGame();
      } else if (gameState === "GAME_OVER") {
        gameState = "TITLE";
      }
      event.preventDefault();
    }
  } else if (gameState === "PLAYING") {
    let newDirection = { x: direction.x, y: direction.y };
    switch (event.code) {
      case "ArrowUp":
      case "KeyW":
        if (direction.y === 0) newDirection = { x: 0, y: -1 };
        break;
      case "ArrowDown":
      case "KeyS":
        if (direction.y === 0) newDirection = { x: 0, y: 1 };
        break;
      case "ArrowLeft":
      case "KeyA":
        if (direction.x === 0) newDirection = { x: -1, y: 0 };
        break;
      case "ArrowRight":
      case "KeyD":
        if (direction.x === 0) newDirection = { x: 1, y: 0 };
        break;
    }
    if (newDirection.x !== -direction.x || newDirection.y !== -direction.y) {
      nextDirection = newDirection;
    }
    event.preventDefault();
  }
}
function resetGame() {
  snake = [];
  const startX = Math.floor(gameSettings.canvasWidth / (gameSettings.gridSize * 4));
  const startY = Math.floor(gameSettings.canvasHeight / (gameSettings.gridSize * 2));
  for (let i = 0; i < gameSettings.initialSnakeLength; i++) {
    snake.push({ x: startX - i, y: startY });
  }
  direction = { x: 1, y: 0 };
  nextDirection = { x: 1, y: 0 };
  score = 0;
  spawnFood();
  lastMoveTime = performance.now();
  if (assets.sounds.bgm && assets.sounds.bgm.paused && !assets.sounds.bgm.muted) {
    assets.sounds.bgm.play().catch((e) => console.warn("Background music autoplay prevented:", e));
  }
}
function spawnFood() {
  let newFood;
  const maxGridX = gameSettings.canvasWidth / gameSettings.gridSize;
  const maxGridY = gameSettings.canvasHeight / gameSettings.gridSize;
  do {
    newFood = {
      x: Math.floor(Math.random() * maxGridX),
      y: Math.floor(Math.random() * maxGridY)
    };
  } while (isOccupiedBySnake(newFood));
  food = newFood;
}
function isOccupiedBySnake(position) {
  return snake.some((segment) => segment.x === position.x && segment.y === position.y);
}
function update(currentTime) {
  if (gameState === "PLAYING") {
    if (currentTime - lastMoveTime > gameSettings.gameSpeed) {
      lastMoveTime = currentTime;
      direction = nextDirection;
      const head = { ...snake[0] };
      head.x += direction.x;
      head.y += direction.y;
      const maxGridX = gameSettings.canvasWidth / gameSettings.gridSize;
      const maxGridY = gameSettings.canvasHeight / gameSettings.gridSize;
      if (head.x < 0 || head.x >= maxGridX || head.y < 0 || head.y >= maxGridY) {
        gameOver();
        return;
      }
      for (let i = 1; i < snake.length; i++) {
        if (head.x === snake[i].x && head.y === snake[i].y) {
          gameOver();
          return;
        }
      }
      if (head.x === food.x && head.y === food.y) {
        score += gameSettings.scorePerFood;
        playSound("eat");
        snake.unshift(head);
        spawnFood();
      } else {
        snake.pop();
        snake.unshift(head);
      }
    }
  }
}
function gameOver() {
  gameState = "GAME_OVER";
  playSound("gameOver");
  if (assets.sounds.bgm) {
    assets.sounds.bgm.pause();
  }
}
function drawScaledImage(image, gridX, gridY, size) {
  ctx.drawImage(image, gridX * size, gridY * size, size, size);
}
function drawText(text, x, y, color, font, align = "center") {
  ctx.fillStyle = color;
  ctx.font = font;
  ctx.textAlign = align;
  ctx.fillText(text, x, y);
}
function playSound(soundName) {
  const sound = assets.sounds[soundName];
  if (sound) {
    sound.currentTime = 0;
    sound.volume = gameSettings.sfxVolume;
    sound.play().catch((e) => console.warn(`Sound ${soundName} autoplay prevented:`, e));
  }
}
function gameLoop(currentTime) {
  update(currentTime);
  draw();
  gameLoopId = requestAnimationFrame(gameLoop);
}
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  switch (gameState) {
    case "TITLE":
      drawBackground(assets.images.titleBackground);
      drawText(gameSettings.title, canvas.width / 2, canvas.height / 2 - 50, gameSettings.textColor, "60px Arial, sans-serif");
      drawText(gameSettings.titleMessage, canvas.width / 2, canvas.height / 2 + 50, gameSettings.textColor, "30px Arial, sans-serif");
      break;
    case "INSTRUCTIONS":
      drawBackground(assets.images.instructionsBackground);
      drawText(gameSettings.instructionsTitle, canvas.width / 2, 100, gameSettings.textColor, "45px Arial, sans-serif");
      drawText(gameSettings.instructionsLine1, canvas.width / 2, 200, gameSettings.textColor, "24px Arial, sans-serif");
      drawText(gameSettings.instructionsLine2, canvas.width / 2, 240, gameSettings.textColor, "24px Arial, sans-serif");
      drawText(gameSettings.instructionsLine3, canvas.width / 2, 280, gameSettings.textColor, "24px Arial, sans-serif");
      drawText(gameSettings.instructionsLine4, canvas.width / 2, 320, gameSettings.textColor, "24px Arial, sans-serif");
      drawText(gameSettings.instructionsMessage, canvas.width / 2, canvas.height - 100, gameSettings.textColor, "30px Arial, sans-serif");
      break;
    case "PLAYING":
      drawBackground(assets.images.gameBackground);
      if (food && assets.images.foodItem) {
        drawScaledImage(assets.images.foodItem, food.x, food.y, gameSettings.gridSize);
      }
      for (let i = 0; i < snake.length; i++) {
        let segmentImage;
        if (i === 0) {
          segmentImage = assets.images.snakeHead;
        } else if (i === snake.length - 1) {
          segmentImage = assets.images.snakeTail;
        } else {
          segmentImage = assets.images.snakeBody;
        }
        drawScaledImage(segmentImage, snake[i].x, snake[i].y, gameSettings.gridSize);
      }
      drawText(`${gameSettings.scorePrefix}${score}`, 10, 30, gameSettings.textColor, "24px Arial, sans-serif", "left");
      break;
    case "GAME_OVER":
      drawBackground(assets.images.gameOverBackground);
      drawText(gameSettings.gameOver, canvas.width / 2, canvas.height / 2 - 80, gameSettings.gameOverColor, "60px Arial, sans-serif");
      drawText(`${gameSettings.gameOverScorePrefix}${score}`, canvas.width / 2, canvas.height / 2, gameSettings.textColor, "40px Arial, sans-serif");
      drawText(gameSettings.gameOverMessage, canvas.width / 2, canvas.height / 2 + 80, gameSettings.textColor, "30px Arial, sans-serif");
      break;
  }
}
function drawBackground(image) {
  if (image) {
    ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
  } else {
    ctx.fillStyle = "#1a1a2e";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }
}
document.addEventListener("DOMContentLoaded", initGame);
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiZ2FtZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLy8gZ2FtZS50c1xyXG5cclxuLy8gR2xvYmFsIHZhcmlhYmxlc1xyXG5sZXQgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudDtcclxubGV0IGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xyXG5sZXQgZ2FtZVNldHRpbmdzOiBhbnk7XHJcbmxldCBhc3NldHM6IHsgaW1hZ2VzOiB7IFtrZXk6IHN0cmluZ106IEhUTUxJbWFnZUVsZW1lbnQgfSwgc291bmRzOiB7IFtrZXk6IHN0cmluZ106IEhUTUxBdWRpb0VsZW1lbnQgfSB9ID0geyBpbWFnZXM6IHt9LCBzb3VuZHM6IHt9IH07XHJcbmxldCBnYW1lU3RhdGU6ICdUSVRMRScgfCAnSU5TVFJVQ1RJT05TJyB8ICdQTEFZSU5HJyB8ICdHQU1FX09WRVInID0gJ1RJVExFJztcclxuXHJcbmxldCBzbmFrZTogeyB4OiBudW1iZXIsIHk6IG51bWJlciB9W10gPSBbXTtcclxubGV0IGZvb2Q6IHsgeDogbnVtYmVyLCB5OiBudW1iZXIgfTtcclxubGV0IHNjb3JlOiBudW1iZXIgPSAwO1xyXG5sZXQgZGlyZWN0aW9uOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH0gPSB7IHg6IDEsIHk6IDAgfTsgLy8gSW5pdGlhbCBkaXJlY3Rpb246IHJpZ2h0XHJcbmxldCBuZXh0RGlyZWN0aW9uOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH0gPSB7IHg6IDEsIHk6IDAgfTsgLy8gQnVmZmVyIGZvciBuZXh0IGlucHV0XHJcbmxldCBsYXN0TW92ZVRpbWU6IG51bWJlciA9IDA7XHJcbmxldCBnYW1lTG9vcElkOiBudW1iZXI7XHJcblxyXG4vLyBBc3NldCBsb2FkaW5nIGFuZCBnYW1lIGluaXRpYWxpemF0aW9uXHJcbmFzeW5jIGZ1bmN0aW9uIGluaXRHYW1lKCkge1xyXG4gICAgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWVDYW52YXMnKSBhcyBIVE1MQ2FudmFzRWxlbWVudDtcclxuICAgIGlmICghY2FudmFzKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkNhbnZhcyBlbGVtZW50IHdpdGggSUQgJ2dhbWVDYW52YXMnIG5vdCBmb3VuZC5cIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJykhO1xyXG5cclxuICAgIGF3YWl0IGxvYWRHYW1lRGF0YSgpO1xyXG4gICAgc2V0dXBDYW52YXMoKTtcclxuICAgIHNldHVwRXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICAvLyBTdGFydCBiYWNrZ3JvdW5kIG11c2ljIChtdXRlZCBieSBkZWZhdWx0IHVudGlsIHVzZXIgaW50ZXJhY3Rpb24pXHJcbiAgICBpZiAoYXNzZXRzLnNvdW5kcy5iZ20pIHtcclxuICAgICAgICBhc3NldHMuc291bmRzLmJnbS5sb29wID0gdHJ1ZTtcclxuICAgICAgICBhc3NldHMuc291bmRzLmJnbS52b2x1bWUgPSBnYW1lU2V0dGluZ3MuYmdtVm9sdW1lO1xyXG4gICAgICAgIGFzc2V0cy5zb3VuZHMuYmdtLm11dGVkID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTdGFydCB0aGUgZ2FtZSBsb29wXHJcbiAgICBnYW1lTG9vcElkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGdhbWVMb29wKTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gbG9hZEdhbWVEYXRhKCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdkYXRhLmpzb24nKTtcclxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgIGdhbWVTZXR0aW5ncyA9IGRhdGEuZ2FtZVNldHRpbmdzO1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oZ2FtZVNldHRpbmdzLCBkYXRhLmNvbG9ycywgZGF0YS50ZXh0KTsgLy8gTWVyZ2UgY29sb3JzIGFuZCB0ZXh0IGludG8gZ2FtZVNldHRpbmdzXHJcbiAgICAgICAgYXdhaXQgbG9hZEFzc2V0cyhkYXRhLmFzc2V0cyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBnYW1lIGRhdGEgb3IgYXNzZXRzOlwiLCBlcnJvcik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGxvYWRBc3NldHMoYXNzZXREYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IGxvYWRJbWFnZVByb21pc2VzID0gKGFzc2V0RGF0YS5pbWFnZXMgfHwgW10pLm1hcCgoaW1nOiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgICAgICAgICBpbWFnZS5zcmMgPSBpbWcucGF0aDtcclxuICAgICAgICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYXNzZXRzLmltYWdlc1tpbWcubmFtZV0gPSBpbWFnZTtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaW1hZ2Uub25lcnJvciA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke2ltZy5wYXRofWApO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBsb2FkU291bmRQcm9taXNlcyA9IChhc3NldERhdGEuc291bmRzIHx8IFtdKS5tYXAoKHNuZDogYW55KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYXVkaW8gPSBuZXcgQXVkaW8oKTtcclxuICAgICAgICAgICAgYXVkaW8uc3JjID0gc25kLnBhdGg7XHJcbiAgICAgICAgICAgIGF1ZGlvLnZvbHVtZSA9IHNuZC52b2x1bWUgfHwgMS4wO1xyXG4gICAgICAgICAgICBhdWRpby5vbmNhbnBsYXl0aHJvdWdoID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYXNzZXRzLnNvdW5kc1tzbmQubmFtZV0gPSBhdWRpbztcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgYXVkaW8ub25lcnJvciA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIHNvdW5kOiAke3NuZC5wYXRofWApO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vIFRyeSB0byBsb2FkIGltbWVkaWF0ZWx5IHRvIHRyaWdnZXIgZXJyb3IgaWYgcGF0aCBpcyBiYWRcclxuICAgICAgICAgICAgYXVkaW8ubG9hZCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoWy4uLmxvYWRJbWFnZVByb21pc2VzLCAuLi5sb2FkU291bmRQcm9taXNlc10pO1xyXG4gICAgY29uc29sZS5sb2coXCJBbGwgYXNzZXRzIGxvYWRlZC5cIik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldHVwQ2FudmFzKCkge1xyXG4gICAgY2FudmFzLndpZHRoID0gZ2FtZVNldHRpbmdzLmNhbnZhc1dpZHRoO1xyXG4gICAgY2FudmFzLmhlaWdodCA9IGdhbWVTZXR0aW5ncy5jYW52YXNIZWlnaHQ7XHJcbiAgICBjdHguaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7IC8vIEZvciBhIG1vcmUgcGl4ZWxhdGVkL3JldHJvIGxvb2tcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0dXBFdmVudExpc3RlbmVycygpIHtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVLZXlEb3duKTtcclxuICAgIC8vIEFkZCBhIGNsaWNrL3RvdWNoIGxpc3RlbmVyIGZvciBpbml0aWFsIHVzZXIgaW50ZXJhY3Rpb24gdG8gdW5tdXRlIHNvdW5kc1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVVc2VySW50ZXJhY3Rpb24sIHsgb25jZTogdHJ1ZSB9KTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBoYW5kbGVVc2VySW50ZXJhY3Rpb24sIHsgb25jZTogdHJ1ZSB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlVXNlckludGVyYWN0aW9uKCkge1xyXG4gICAgaWYgKGFzc2V0cy5zb3VuZHMuYmdtKSB7XHJcbiAgICAgICAgYXNzZXRzLnNvdW5kcy5iZ20ubXV0ZWQgPSBmYWxzZTtcclxuICAgICAgICBhc3NldHMuc291bmRzLmJnbS5wbGF5KCkuY2F0Y2goZSA9PiBjb25zb2xlLndhcm4oXCJCYWNrZ3JvdW5kIG11c2ljIGF1dG9wbGF5IHByZXZlbnRlZDpcIiwgZSkpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVLZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XHJcbiAgICBpZiAoZ2FtZVN0YXRlID09PSAnVElUTEUnIHx8IGdhbWVTdGF0ZSA9PT0gJ0lOU1RSVUNUSU9OUycgfHwgZ2FtZVN0YXRlID09PSAnR0FNRV9PVkVSJykge1xyXG4gICAgICAgIGlmIChldmVudC5jb2RlID09PSAnU3BhY2UnKSB7XHJcbiAgICAgICAgICAgIHBsYXlTb3VuZCgnbWVudVNlbGVjdCcpO1xyXG4gICAgICAgICAgICBpZiAoZ2FtZVN0YXRlID09PSAnVElUTEUnKSB7XHJcbiAgICAgICAgICAgICAgICBnYW1lU3RhdGUgPSAnSU5TVFJVQ1RJT05TJztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChnYW1lU3RhdGUgPT09ICdJTlNUUlVDVElPTlMnKSB7XHJcbiAgICAgICAgICAgICAgICBnYW1lU3RhdGUgPSAnUExBWUlORyc7XHJcbiAgICAgICAgICAgICAgICByZXNldEdhbWUoKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChnYW1lU3RhdGUgPT09ICdHQU1FX09WRVInKSB7XHJcbiAgICAgICAgICAgICAgICBnYW1lU3RhdGUgPSAnVElUTEUnOyAvLyBHbyBiYWNrIHRvIHRpdGxlIHNjcmVlbiB0byByZXN0YXJ0XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gUHJldmVudCBwYWdlIHNjcm9sbGluZ1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoZ2FtZVN0YXRlID09PSAnUExBWUlORycpIHtcclxuICAgICAgICBsZXQgbmV3RGlyZWN0aW9uID0geyB4OiBkaXJlY3Rpb24ueCwgeTogZGlyZWN0aW9uLnkgfTtcclxuICAgICAgICBzd2l0Y2ggKGV2ZW50LmNvZGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnQXJyb3dVcCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ0tleVcnOlxyXG4gICAgICAgICAgICAgICAgaWYgKGRpcmVjdGlvbi55ID09PSAwKSBuZXdEaXJlY3Rpb24gPSB7IHg6IDAsIHk6IC0xIH07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnQXJyb3dEb3duJzpcclxuICAgICAgICAgICAgY2FzZSAnS2V5Uyc6XHJcbiAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uLnkgPT09IDApIG5ld0RpcmVjdGlvbiA9IHsgeDogMCwgeTogMSB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ0Fycm93TGVmdCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ0tleUEnOlxyXG4gICAgICAgICAgICAgICAgaWYgKGRpcmVjdGlvbi54ID09PSAwKSBuZXdEaXJlY3Rpb24gPSB7IHg6IC0xLCB5OiAwIH07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnQXJyb3dSaWdodCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ0tleUQnOlxyXG4gICAgICAgICAgICAgICAgaWYgKGRpcmVjdGlvbi54ID09PSAwKSBuZXdEaXJlY3Rpb24gPSB7IHg6IDEsIHk6IDAgfTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBPbmx5IHVwZGF0ZSBuZXh0RGlyZWN0aW9uIGlmIGl0J3MgYSB2YWxpZCBjaGFuZ2UgKG5vdCByZXZlcnNpbmcgZGlyZWN0aW9uKVxyXG4gICAgICAgIGlmIChuZXdEaXJlY3Rpb24ueCAhPT0gLWRpcmVjdGlvbi54IHx8IG5ld0RpcmVjdGlvbi55ICE9PSAtZGlyZWN0aW9uLnkpIHtcclxuICAgICAgICAgICAgbmV4dERpcmVjdGlvbiA9IG5ld0RpcmVjdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gUHJldmVudCBwYWdlIHNjcm9sbGluZ1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiByZXNldEdhbWUoKSB7XHJcbiAgICBzbmFrZSA9IFtdO1xyXG4gICAgLy8gSW5pdGlhbGl6ZSBzbmFrZSBpbiB0aGUgbWlkZGxlLWxlZnQgcGFydCBvZiB0aGUgc2NyZWVuXHJcbiAgICBjb25zdCBzdGFydFggPSBNYXRoLmZsb29yKGdhbWVTZXR0aW5ncy5jYW52YXNXaWR0aCAvIChnYW1lU2V0dGluZ3MuZ3JpZFNpemUgKiA0KSk7XHJcbiAgICBjb25zdCBzdGFydFkgPSBNYXRoLmZsb29yKGdhbWVTZXR0aW5ncy5jYW52YXNIZWlnaHQgLyAoZ2FtZVNldHRpbmdzLmdyaWRTaXplICogMikpO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnYW1lU2V0dGluZ3MuaW5pdGlhbFNuYWtlTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBzbmFrZS5wdXNoKHsgeDogc3RhcnRYIC0gaSwgeTogc3RhcnRZIH0pO1xyXG4gICAgfVxyXG4gICAgZGlyZWN0aW9uID0geyB4OiAxLCB5OiAwIH07XHJcbiAgICBuZXh0RGlyZWN0aW9uID0geyB4OiAxLCB5OiAwIH07XHJcbiAgICBzY29yZSA9IDA7XHJcbiAgICBzcGF3bkZvb2QoKTtcclxuICAgIGxhc3RNb3ZlVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgXHJcbiAgICAvLyBFbnN1cmUgQkdNIGlzIHBsYXlpbmcgaWYgaXQgd2FzIHBhdXNlZCBkdXJpbmcgZ2FtZSBvdmVyXHJcbiAgICBpZiAoYXNzZXRzLnNvdW5kcy5iZ20gJiYgYXNzZXRzLnNvdW5kcy5iZ20ucGF1c2VkICYmICFhc3NldHMuc291bmRzLmJnbS5tdXRlZCkge1xyXG4gICAgICAgIGFzc2V0cy5zb3VuZHMuYmdtLnBsYXkoKS5jYXRjaChlID0+IGNvbnNvbGUud2FybihcIkJhY2tncm91bmQgbXVzaWMgYXV0b3BsYXkgcHJldmVudGVkOlwiLCBlKSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNwYXduRm9vZCgpIHtcclxuICAgIGxldCBuZXdGb29kOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XHJcbiAgICBjb25zdCBtYXhHcmlkWCA9IGdhbWVTZXR0aW5ncy5jYW52YXNXaWR0aCAvIGdhbWVTZXR0aW5ncy5ncmlkU2l6ZTtcclxuICAgIGNvbnN0IG1heEdyaWRZID0gZ2FtZVNldHRpbmdzLmNhbnZhc0hlaWdodCAvIGdhbWVTZXR0aW5ncy5ncmlkU2l6ZTtcclxuXHJcbiAgICBkbyB7XHJcbiAgICAgICAgbmV3Rm9vZCA9IHtcclxuICAgICAgICAgICAgeDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4R3JpZFgpLFxyXG4gICAgICAgICAgICB5OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhHcmlkWSlcclxuICAgICAgICB9O1xyXG4gICAgfSB3aGlsZSAoaXNPY2N1cGllZEJ5U25ha2UobmV3Rm9vZCkpO1xyXG5cclxuICAgIGZvb2QgPSBuZXdGb29kO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc09jY3VwaWVkQnlTbmFrZShwb3NpdGlvbjogeyB4OiBudW1iZXIsIHk6IG51bWJlciB9KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gc25ha2Uuc29tZShzZWdtZW50ID0+IHNlZ21lbnQueCA9PT0gcG9zaXRpb24ueCAmJiBzZWdtZW50LnkgPT09IHBvc2l0aW9uLnkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGUoY3VycmVudFRpbWU6IG51bWJlcikge1xyXG4gICAgaWYgKGdhbWVTdGF0ZSA9PT0gJ1BMQVlJTkcnKSB7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRUaW1lIC0gbGFzdE1vdmVUaW1lID4gZ2FtZVNldHRpbmdzLmdhbWVTcGVlZCkge1xyXG4gICAgICAgICAgICBsYXN0TW92ZVRpbWUgPSBjdXJyZW50VGltZTtcclxuICAgICAgICAgICAgZGlyZWN0aW9uID0gbmV4dERpcmVjdGlvbjsgLy8gQXBwbHkgYnVmZmVyZWQgZGlyZWN0aW9uXHJcblxyXG4gICAgICAgICAgICBjb25zdCBoZWFkID0geyAuLi5zbmFrZVswXSB9OyAvLyBDb3B5IGN1cnJlbnQgaGVhZFxyXG5cclxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIG5ldyBoZWFkIHBvc2l0aW9uXHJcbiAgICAgICAgICAgIGhlYWQueCArPSBkaXJlY3Rpb24ueDtcclxuICAgICAgICAgICAgaGVhZC55ICs9IGRpcmVjdGlvbi55O1xyXG5cclxuICAgICAgICAgICAgLy8gV2FsbCBjb2xsaXNpb25cclxuICAgICAgICAgICAgY29uc3QgbWF4R3JpZFggPSBnYW1lU2V0dGluZ3MuY2FudmFzV2lkdGggLyBnYW1lU2V0dGluZ3MuZ3JpZFNpemU7XHJcbiAgICAgICAgICAgIGNvbnN0IG1heEdyaWRZID0gZ2FtZVNldHRpbmdzLmNhbnZhc0hlaWdodCAvIGdhbWVTZXR0aW5ncy5ncmlkU2l6ZTtcclxuICAgICAgICAgICAgaWYgKGhlYWQueCA8IDAgfHwgaGVhZC54ID49IG1heEdyaWRYIHx8IGhlYWQueSA8IDAgfHwgaGVhZC55ID49IG1heEdyaWRZKSB7XHJcbiAgICAgICAgICAgICAgICBnYW1lT3ZlcigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBTZWxmIGNvbGxpc2lvbiAoc3RhcnQgY2hlY2tpbmcgZnJvbSB0aGUgNHRoIHNlZ21lbnQgdG8gYXZvaWQgaW1tZWRpYXRlIGdhbWUgb3ZlciBvbiBzdGFydC90dXJuKVxyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNuYWtlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaGVhZC54ID09PSBzbmFrZVtpXS54ICYmIGhlYWQueSA9PT0gc25ha2VbaV0ueSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdhbWVPdmVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBGb29kIGNvbGxpc2lvblxyXG4gICAgICAgICAgICBpZiAoaGVhZC54ID09PSBmb29kLnggJiYgaGVhZC55ID09PSBmb29kLnkpIHsgLy8gRml4ZWQ6IENoYW5nZWQgZm9vZC55ID09PSBmb29kLnkgdG8gaGVhZC55ID09PSBmb29kLnlcclxuICAgICAgICAgICAgICAgIHNjb3JlICs9IGdhbWVTZXR0aW5ncy5zY29yZVBlckZvb2Q7XHJcbiAgICAgICAgICAgICAgICBwbGF5U291bmQoJ2VhdCcpO1xyXG4gICAgICAgICAgICAgICAgc25ha2UudW5zaGlmdChoZWFkKTsgLy8gQWRkIG5ldyBoZWFkLCBib2R5IHdpbGwgZ3Jvd1xyXG4gICAgICAgICAgICAgICAgc3Bhd25Gb29kKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBNb3ZlIHNuYWtlIGJ5IGFkZGluZyBuZXcgaGVhZCBhbmQgcmVtb3ZpbmcgdGFpbFxyXG4gICAgICAgICAgICAgICAgc25ha2UucG9wKCk7IC8vIFJlbW92ZSB0YWlsXHJcbiAgICAgICAgICAgICAgICBzbmFrZS51bnNoaWZ0KGhlYWQpOyAvLyBBZGQgbmV3IGhlYWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2FtZU92ZXIoKSB7XHJcbiAgICBnYW1lU3RhdGUgPSAnR0FNRV9PVkVSJztcclxuICAgIHBsYXlTb3VuZCgnZ2FtZU92ZXInKTtcclxuICAgIGlmIChhc3NldHMuc291bmRzLmJnbSkge1xyXG4gICAgICAgIGFzc2V0cy5zb3VuZHMuYmdtLnBhdXNlKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRyYXdTY2FsZWRJbWFnZShpbWFnZTogSFRNTEltYWdlRWxlbWVudCwgZ3JpZFg6IG51bWJlciwgZ3JpZFk6IG51bWJlciwgc2l6ZTogbnVtYmVyKSB7XHJcbiAgICBjdHguZHJhd0ltYWdlKGltYWdlLCBncmlkWCAqIHNpemUsIGdyaWRZICogc2l6ZSwgc2l6ZSwgc2l6ZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRyYXdUZXh0KHRleHQ6IHN0cmluZywgeDogbnVtYmVyLCB5OiBudW1iZXIsIGNvbG9yOiBzdHJpbmcsIGZvbnQ6IHN0cmluZywgYWxpZ246IENhbnZhc1RleHRBbGlnbiA9ICdjZW50ZXInKSB7XHJcbiAgICBjdHguZmlsbFN0eWxlID0gY29sb3I7XHJcbiAgICBjdHguZm9udCA9IGZvbnQ7XHJcbiAgICBjdHgudGV4dEFsaWduID0gYWxpZ247XHJcbiAgICBjdHguZmlsbFRleHQodGV4dCwgeCwgeSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBsYXlTb3VuZChzb3VuZE5hbWU6IHN0cmluZykge1xyXG4gICAgY29uc3Qgc291bmQgPSBhc3NldHMuc291bmRzW3NvdW5kTmFtZV07XHJcbiAgICBpZiAoc291bmQpIHtcclxuICAgICAgICBzb3VuZC5jdXJyZW50VGltZSA9IDA7IC8vIFJld2luZCB0byBzdGFydFxyXG4gICAgICAgIHNvdW5kLnZvbHVtZSA9IGdhbWVTZXR0aW5ncy5zZnhWb2x1bWU7XHJcbiAgICAgICAgc291bmQucGxheSgpLmNhdGNoKGUgPT4gY29uc29sZS53YXJuKGBTb3VuZCAke3NvdW5kTmFtZX0gYXV0b3BsYXkgcHJldmVudGVkOmAsIGUpKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2FtZUxvb3AoY3VycmVudFRpbWU6IG51bWJlcikge1xyXG4gICAgdXBkYXRlKGN1cnJlbnRUaW1lKTtcclxuICAgIGRyYXcoKTtcclxuICAgIGdhbWVMb29wSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZ2FtZUxvb3ApO1xyXG59XHJcblxyXG5mdW5jdGlvbiBkcmF3KCkge1xyXG4gICAgLy8gQ2xlYXIgY2FudmFzXHJcbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcblxyXG4gICAgc3dpdGNoIChnYW1lU3RhdGUpIHtcclxuICAgICAgICBjYXNlICdUSVRMRSc6XHJcbiAgICAgICAgICAgIGRyYXdCYWNrZ3JvdW5kKGFzc2V0cy5pbWFnZXMudGl0bGVCYWNrZ3JvdW5kKTtcclxuICAgICAgICAgICAgZHJhd1RleHQoZ2FtZVNldHRpbmdzLnRpdGxlLCBjYW52YXMud2lkdGggLyAyLCBjYW52YXMuaGVpZ2h0IC8gMiAtIDUwLCBnYW1lU2V0dGluZ3MudGV4dENvbG9yLCAnNjBweCBBcmlhbCwgc2Fucy1zZXJpZicpO1xyXG4gICAgICAgICAgICBkcmF3VGV4dChnYW1lU2V0dGluZ3MudGl0bGVNZXNzYWdlLCBjYW52YXMud2lkdGggLyAyLCBjYW52YXMuaGVpZ2h0IC8gMiArIDUwLCBnYW1lU2V0dGluZ3MudGV4dENvbG9yLCAnMzBweCBBcmlhbCwgc2Fucy1zZXJpZicpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSAnSU5TVFJVQ1RJT05TJzpcclxuICAgICAgICAgICAgZHJhd0JhY2tncm91bmQoYXNzZXRzLmltYWdlcy5pbnN0cnVjdGlvbnNCYWNrZ3JvdW5kKTtcclxuICAgICAgICAgICAgZHJhd1RleHQoZ2FtZVNldHRpbmdzLmluc3RydWN0aW9uc1RpdGxlLCBjYW52YXMud2lkdGggLyAyLCAxMDAsIGdhbWVTZXR0aW5ncy50ZXh0Q29sb3IsICc0NXB4IEFyaWFsLCBzYW5zLXNlcmlmJyk7XHJcbiAgICAgICAgICAgIGRyYXdUZXh0KGdhbWVTZXR0aW5ncy5pbnN0cnVjdGlvbnNMaW5lMSwgY2FudmFzLndpZHRoIC8gMiwgMjAwLCBnYW1lU2V0dGluZ3MudGV4dENvbG9yLCAnMjRweCBBcmlhbCwgc2Fucy1zZXJpZicpO1xyXG4gICAgICAgICAgICBkcmF3VGV4dChnYW1lU2V0dGluZ3MuaW5zdHJ1Y3Rpb25zTGluZTIsIGNhbnZhcy53aWR0aCAvIDIsIDI0MCwgZ2FtZVNldHRpbmdzLnRleHRDb2xvciwgJzI0cHggQXJpYWwsIHNhbnMtc2VyaWYnKTtcclxuICAgICAgICAgICAgZHJhd1RleHQoZ2FtZVNldHRpbmdzLmluc3RydWN0aW9uc0xpbmUzLCBjYW52YXMud2lkdGggLyAyLCAyODAsIGdhbWVTZXR0aW5ncy50ZXh0Q29sb3IsICcyNHB4IEFyaWFsLCBzYW5zLXNlcmlmJyk7XHJcbiAgICAgICAgICAgIGRyYXdUZXh0KGdhbWVTZXR0aW5ncy5pbnN0cnVjdGlvbnNMaW5lNCwgY2FudmFzLndpZHRoIC8gMiwgMzIwLCBnYW1lU2V0dGluZ3MudGV4dENvbG9yLCAnMjRweCBBcmlhbCwgc2Fucy1zZXJpZicpO1xyXG4gICAgICAgICAgICBkcmF3VGV4dChnYW1lU2V0dGluZ3MuaW5zdHJ1Y3Rpb25zTWVzc2FnZSwgY2FudmFzLndpZHRoIC8gMiwgY2FudmFzLmhlaWdodCAtIDEwMCwgZ2FtZVNldHRpbmdzLnRleHRDb2xvciwgJzMwcHggQXJpYWwsIHNhbnMtc2VyaWYnKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ1BMQVlJTkcnOlxyXG4gICAgICAgICAgICBkcmF3QmFja2dyb3VuZChhc3NldHMuaW1hZ2VzLmdhbWVCYWNrZ3JvdW5kKTtcclxuXHJcbiAgICAgICAgICAgIC8vIERyYXcgZm9vZFxyXG4gICAgICAgICAgICBpZiAoZm9vZCAmJiBhc3NldHMuaW1hZ2VzLmZvb2RJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBkcmF3U2NhbGVkSW1hZ2UoYXNzZXRzLmltYWdlcy5mb29kSXRlbSwgZm9vZC54LCBmb29kLnksIGdhbWVTZXR0aW5ncy5ncmlkU2l6ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIERyYXcgc25ha2VcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzbmFrZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgbGV0IHNlZ21lbnRJbWFnZTogSFRNTEltYWdlRWxlbWVudDtcclxuICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSB7IC8vIEhlYWRcclxuICAgICAgICAgICAgICAgICAgICBzZWdtZW50SW1hZ2UgPSBhc3NldHMuaW1hZ2VzLnNuYWtlSGVhZDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA9PT0gc25ha2UubGVuZ3RoIC0gMSkgeyAvLyBUYWlsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VnbWVudEltYWdlID0gYXNzZXRzLmltYWdlcy5zbmFrZVRhaWw7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBCb2R5XHJcbiAgICAgICAgICAgICAgICAgICAgc2VnbWVudEltYWdlID0gYXNzZXRzLmltYWdlcy5zbmFrZUJvZHk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkcmF3U2NhbGVkSW1hZ2Uoc2VnbWVudEltYWdlLCBzbmFrZVtpXS54LCBzbmFrZVtpXS55LCBnYW1lU2V0dGluZ3MuZ3JpZFNpemUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBEcmF3IHNjb3JlXHJcbiAgICAgICAgICAgIGRyYXdUZXh0KGAke2dhbWVTZXR0aW5ncy5zY29yZVByZWZpeH0ke3Njb3JlfWAsIDEwLCAzMCwgZ2FtZVNldHRpbmdzLnRleHRDb2xvciwgJzI0cHggQXJpYWwsIHNhbnMtc2VyaWYnLCAnbGVmdCcpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSAnR0FNRV9PVkVSJzpcclxuICAgICAgICAgICAgZHJhd0JhY2tncm91bmQoYXNzZXRzLmltYWdlcy5nYW1lT3ZlckJhY2tncm91bmQpO1xyXG4gICAgICAgICAgICBkcmF3VGV4dChnYW1lU2V0dGluZ3MuZ2FtZU92ZXIsIGNhbnZhcy53aWR0aCAvIDIsIGNhbnZhcy5oZWlnaHQgLyAyIC0gODAsIGdhbWVTZXR0aW5ncy5nYW1lT3ZlckNvbG9yLCAnNjBweCBBcmlhbCwgc2Fucy1zZXJpZicpO1xyXG4gICAgICAgICAgICBkcmF3VGV4dChgJHtnYW1lU2V0dGluZ3MuZ2FtZU92ZXJTY29yZVByZWZpeH0ke3Njb3JlfWAsIGNhbnZhcy53aWR0aCAvIDIsIGNhbnZhcy5oZWlnaHQgLyAyLCBnYW1lU2V0dGluZ3MudGV4dENvbG9yLCAnNDBweCBBcmlhbCwgc2Fucy1zZXJpZicpO1xyXG4gICAgICAgICAgICBkcmF3VGV4dChnYW1lU2V0dGluZ3MuZ2FtZU92ZXJNZXNzYWdlLCBjYW52YXMud2lkdGggLyAyLCBjYW52YXMuaGVpZ2h0IC8gMiArIDgwLCBnYW1lU2V0dGluZ3MudGV4dENvbG9yLCAnMzBweCBBcmlhbCwgc2Fucy1zZXJpZicpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZHJhd0JhY2tncm91bmQoaW1hZ2U6IEhUTUxJbWFnZUVsZW1lbnQpIHtcclxuICAgIGlmIChpbWFnZSkge1xyXG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzFhMWEyZSc7IC8vIEZhbGxiYWNrIHNvbGlkIGJhY2tncm91bmQgY29sb3JcclxuICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcclxuICAgIH1cclxufVxyXG5cclxuLy8gRW5zdXJlIHRoZSBnYW1lIHN0YXJ0cyB3aGVuIHRoZSBET00gaXMgZnVsbHkgbG9hZGVkXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBpbml0R2FtZSk7XHJcbiJdLAogICJtYXBwaW5ncyI6ICJBQUdBLElBQUk7QUFDSixJQUFJO0FBQ0osSUFBSTtBQUNKLElBQUksU0FBdUcsRUFBRSxRQUFRLENBQUMsR0FBRyxRQUFRLENBQUMsRUFBRTtBQUNwSSxJQUFJLFlBQWdFO0FBRXBFLElBQUksUUFBb0MsQ0FBQztBQUN6QyxJQUFJO0FBQ0osSUFBSSxRQUFnQjtBQUNwQixJQUFJLFlBQXNDLEVBQUUsR0FBRyxHQUFHLEdBQUcsRUFBRTtBQUN2RCxJQUFJLGdCQUEwQyxFQUFFLEdBQUcsR0FBRyxHQUFHLEVBQUU7QUFDM0QsSUFBSSxlQUF1QjtBQUMzQixJQUFJO0FBR0osZUFBZSxXQUFXO0FBQ3RCLFdBQVMsU0FBUyxlQUFlLFlBQVk7QUFDN0MsTUFBSSxDQUFDLFFBQVE7QUFDVCxZQUFRLE1BQU0sZ0RBQWdEO0FBQzlEO0FBQUEsRUFDSjtBQUNBLFFBQU0sT0FBTyxXQUFXLElBQUk7QUFFNUIsUUFBTSxhQUFhO0FBQ25CLGNBQVk7QUFDWixzQkFBb0I7QUFHcEIsTUFBSSxPQUFPLE9BQU8sS0FBSztBQUNuQixX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
